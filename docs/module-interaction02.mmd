flowchart BT

classDef dottedBox fill:transparent,fill-opacity:0.55, stroke-dasharray:20 5,stroke-width:2px;
classDef stressedBox fill:#f0f0f0,fill-opacity:0.4,stroke-width:5px;

coreAudioApi["Core Audio<br>(Windows API)"]

subgraph scannerBackend["Sound Scanner backend"]
    goCgoWrapper["SoundLibWrap<br>(Go/CGO module)"]
    soundAgentApiDll["SoundAgentApi.dll<br>(ANSI C API)"]
    soundDeviceCollection["SoundAgentLib::<br>SoundDeviceCollection<br>(C++ class)"]
end
class scannerBackend dottedBox

coreAudioApi -->|Device and volume change<br>notifications| soundDeviceCollection
soundDeviceCollection --> |Read device characteristics| coreAudioApi

subgraph scannerService["<b>win-sound-scanner-go</b>"]
    winSoundScannerService["<b>WinSoundScanner<br>(Go Windows Service)</b>"]
end
class scannerService stressedBox

subgraph requestQueueMicroservice["Request queue microservice"]
    requestQueue[("Request Queue<br>(RabbitMQ channel)")]
    rabbitMqRestForwarder["RabbitMQ-to-REST Forwarder<br>(.NET microservice)"]
end
class requestQueueMicroservice dottedBox

deviceRepositoryApi["Device Repository Server<br>(REST API)"]

winSoundScannerService --> |Access device| goCgoWrapper
goCgoWrapper -->|Device events| winSoundScannerService

goCgoWrapper --> |Call C API| soundAgentApiDll
soundAgentApiDll --> |Call C++ API| soundDeviceCollection

soundDeviceCollection -->|SaaEvent callbacks| soundAgentApiDll
soundAgentApiDll -->|CGO callbacks| goCgoWrapper

winSoundScannerService -->|Enqueue request messages| requestQueue

requestQueue -->|Fetch request messages| rabbitMqRestForwarder
rabbitMqRestForwarder --> |Detect request messages| requestQueue
rabbitMqRestForwarder -->|Forward request messages| deviceRepositoryApi
